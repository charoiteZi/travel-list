<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ—…è¡Œæ¸…å•</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB",
          "Microsoft YaHei", sans-serif;
        background-color: #f5f5f5;
        color: #262626;
        line-height: 1.6;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        padding: 24px;
      }

      .header {
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #f0f0f0;
      }

      h1 {
        font-size: 20px;
        font-weight: 600;
        color: #1f1f1f;
        margin: 0;
      }

      .reset-btn {
        background: #1890ff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .reset-btn:hover {
        background: #40a9ff;
        transform: translateY(-1px);
      }

      .reset-btn:active {
        transform: translateY(0);
      }

      .task-list {
        list-style: none;
      }

      .task-item {
        padding: 4px 0;
        position: relative;
      }

      .task-content {
        display: flex;
        align-items: flex-start;
        min-height: 28px;
      }

      .checkbox-wrapper {
        margin-right: 12px;
        margin-top: 2px;
        position: relative;
      }

      .custom-checkbox {
        width: 16px;
        height: 16px;
        border: 2px solid #d9d9d9;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
      }

      .custom-checkbox:hover {
        border-color: #1890ff;
      }

      .custom-checkbox.checked {
        background: #1890ff;
        border-color: #1890ff;
      }

      .custom-checkbox.checked::after {
        content: "âœ“";
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }

      .task-label {
        flex: 1;
        cursor: pointer;
        user-select: none;
        padding-top: 1px;
        transition: color 0.2s ease;
      }

      .task-label.must {
        color: #ff4d4f;
      }

      input[type="checkbox"]:checked + .custom-checkbox + .task-label {
        color: #8c8c8c;
        text-decoration: line-through;
      }

      .children {
        margin-left: 28px;
        border-left: 1px dashed #e8e8e8;
        padding-left: 12px;
        margin-top: 4px;
      }

      .folder {
        position: relative;
        padding-left: 24px;
        cursor: pointer;
        user-select: none;
      }

      .folder::before {
        content: "â–¶";
        position: absolute;
        left: 8px;
        transition: transform 0.2s;
      }

      .folder.expanded::before {
        transform: rotate(90deg);
      }

      .children.collapsed {
        display: none;
      }

      .stats {
        margin-top: 20px;
        padding-top: 16px;
        border-top: 1px solid #f0f0f0;
        color: #8c8c8c;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .progress-bar {
        width: 120px;
        height: 6px;
        background: #f0f0f0;
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: #52c41a;
        border-radius: 3px;
        transition: width 0.3s ease;
      }
      .split-line {
        height: 24px; /* å¢åŠ é«˜åº¦å®¹çº³emoji */
        background: transparent;
        position: relative;
        margin: 16px 0;
        display: flex;
        align-items: center;
      }

      .split-line::before {
        content: "ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤";
        color: #e8e8e8;
        letter-spacing: 8px;
        font-size: 18px;
        position: absolute;
        left: -28px;
        white-space: nowrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>æ—…è¡Œæ¸…å•</h1>
        <p style="color: #8c8c8c">é‡ç½®è¯·åˆ·æ–°ç½‘é¡µ</p>
      </div>

      <div id="task-tree" class="task-list"></div>

      <!-- <div class="stats">
        <div>å·²å®Œæˆ: <span id="completed-count">0</span> / æ€»è®¡: <span id="total-count">0</span></div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
      </div> -->
    </div>

    <script type="module">
      import { dataList } from "./data.js";

      // å­˜å‚¨æ‰€æœ‰å¤é€‰æ¡†å¼•ç”¨
      let allCheckboxes = [];

      // æ¸²æŸ“æ ‘å½¢ç»“æ„
      function renderTree(data, parentElement, level = 0) {
        let totalCount = 0;

        data.forEach((item) => {
          const li = document.createElement("li");
          li.className = "task-item";

          if (item.name === "split") {
            const splitLine = document.createElement("div");
            splitLine.className = "split-line";
            li.appendChild(splitLine);
          } else if (item.children) {
            // æ–‡ä»¶å¤¹èŠ‚ç‚¹
            const folderDiv = document.createElement("div");
            folderDiv.className = "folder";
            folderDiv.innerHTML = `
        <span class="folder-name">${item.name}</span>
        <span class="item-count">(${item.children.length})</span>
      `;
            li.appendChild(folderDiv);

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            folderDiv.addEventListener("click", function () {
              this.classList.toggle("expanded");
              childrenUl.classList.toggle("collapsed");
              updateStats(); // æ›´æ–°ç»Ÿè®¡æ—¶è¦è€ƒè™‘æŠ˜å çŠ¶æ€
            });

            // é»˜è®¤å±•å¼€
            folderDiv.classList.add("expanded");

            // æ¸²æŸ“å­èŠ‚ç‚¹
            const childrenUl = document.createElement("ul");
            childrenUl.className = "children";
            const childTotal = renderTree(item.children, childrenUl, level + 1);
            totalCount += childTotal;
            li.appendChild(childrenUl);
          } else {
            // å¶å­èŠ‚ç‚¹ï¼ˆå¤é€‰æ¡†ï¼‰
            const label = document.createElement("label");
            label.className = "task-content";

            const checkboxWrapper = document.createElement("div");
            checkboxWrapper.className = "checkbox-wrapper";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `task-${item.id}`;
            checkbox.dataset.id = item.id;

            const customCheckbox = document.createElement("div");
            customCheckbox.className = "custom-checkbox";

            const taskLabel = document.createElement("span");
            taskLabel.className = "task-label";
            if (item.normal) {
              taskLabel.classList.add("must");
            }
            taskLabel.textContent = item.name;
            taskLabel.htmlFor = `task-${item.id}`;

            checkboxWrapper.appendChild(checkbox);
            checkboxWrapper.appendChild(customCheckbox);
            label.appendChild(checkboxWrapper);
            label.appendChild(taskLabel);
            li.appendChild(label);

            // å­˜å‚¨å¤é€‰æ¡†å¼•ç”¨
            allCheckboxes.push({
              checkbox: checkbox,
              customCheckbox: customCheckbox,
              taskLabel: taskLabel,
            });

            totalCount++;

            // æ·»åŠ äº‹ä»¶ç›‘å¬
            checkbox.addEventListener("change", function () {
              updateCheckboxState(this, customCheckbox, taskLabel);
              updateStats();
            });
          }

          parentElement.appendChild(li);
        });

        return totalCount;
      }

      // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
      function updateCheckboxState(checkbox, customCheckbox, taskLabel) {
        if (checkbox.checked) {
          customCheckbox.classList.add("checked");
          taskLabel.style.color = "#8c8c8c";
          taskLabel.style.textDecoration = "line-through";
        } else {
          customCheckbox.classList.remove("checked");
          taskLabel.style.color = "";
          taskLabel.style.textDecoration = "";
        }
      }

      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      function updateStats() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const completed = Array.from(checkboxes).filter((cb) => cb.checked).length;
        const total = checkboxes.length;
        const percentage = total > 0 ? (completed / total) * 100 : 0;

        document.getElementById("completed-count").textContent = completed;
        document.getElementById("total-count").textContent = total;
        document.getElementById("progress-fill").style.width = `${percentage}%`;
      }

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        const taskTree = document.getElementById("task-tree");
        const totalCount = renderTree(dataList, taskTree);

        document.querySelectorAll(".folder").forEach((folder) => {
          folder.click(); // è§¦å‘é»˜è®¤å±•å¼€çŠ¶æ€
          folder.click(); // é‡ç½®ä¸ºé»˜è®¤å±•å¼€
        });

        // å–æ¶ˆæ³¨é‡Šç»Ÿè®¡éƒ¨åˆ†
        document.querySelector(".stats").style.display = "block";
        document.getElementById("total-count").textContent = totalCount;

        // æ·»åŠ é‡ç½®æŒ‰é’®äº‹ä»¶ç›‘å¬
        document.getElementById("reset-btn").addEventListener("click", resetAllCheckboxes);
      });
    </script>
  </body>
</html>
